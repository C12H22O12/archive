# 코드에서 나는 악취

 리팩터링의 '시점'을 파악하는 것은 작동 원리를 아는 것 못지않게 중요하나, 때로는 너무 간단하기에 그 시점을 파악해야하는 지에 대해서는 명확하게 정립된 규칙이 없다. 저자와 켄트는 리팩터링이 필요한 코드들은 일정한 패턴이 있다는 사실을 발견했다. 켄트 벡은 리팩터링할 '시점'을 설명하는 데 '냄새(smell)'란 표현을 사용했다. 이 챕터에서는 리팩터링하면 해결할 수 있는 문제의 징후를 제시한다.

 <br />
 <br />
 <br />

## 3.1 기이한 이름(Mysterious Name)

코드는 단순하고 명료하게 작성해야한다. 이를 지키는 데 가장 중요한 요소 중 하나는 '이름'이다. 어떤 모듈, 함수, 변수, 클래스 등은 이름만 보고도 각각이 무슨 일을 하고 어떻게 사용해야 하는지 명확히 알 수 있도록 해야한다. 그래야 나중에 문맥을 파악하느라 헤매는 시간을 크게 절약할 수 있다. `함수 선언 바꾸기`, `변수 이름 바꾸기`, `필드 이름 바꾸기` 등 리팩터링에도 이름을 바꾸는 기법들이 있다. 또한 변수의 이름을 정할 때, 마땅한 이름이 떠오르지 않는다면 설계에 더 근본적인 문제가 숨어있을 가능성이 높다.

 <br />
 <br />
 <br />

## 3.2 중복 코드(Duplicated Code)

코드가 중복되면 차이점을 찾는 데 부담이 생긴다. 또한 그 중 하나를 변경할 경우 다른 비슷한 코드들도 모두 살펴보고 적절히 수정해야 한다. 이런 경우 다음과 같이 리팩터링 기법을 대응할 수 있다.

|문제|기법|해결||
|--|--|--|--|
|한 클래스에 있는 두 메서드가 똑같은 표현식 사용|`함수 추출하기`|양쪽 모두 추출된 메서드를 호출하게 변경|6.1|
|코드가 비슷한데 완전히 똑같지는 않음|`문장 슬라이드하기`|비슷한 부분을 한 곳에 모은 후, `함수 추출하기` 적용 여부 판단|8.1|
|같은 부모로부터 파생된 서브 클래스들에 코드가 중복|`메서드 올리기`|각자 따로 호출되지 않도록 기법 적용, 부모로 이동시킴|12.1절|

 <br />
 <br />
 <br />

## 3.3 긴 함수

짧은 함수들로 구성된 코드 페이스를 얼핏 훑으면 연산하는 부분이 하나도 없어 보인다. 코드가 끝없이 위임하는 방식으로 작성되어 있기 때문이다. 간접 호출(indirection)의 효과, 즉 코드를 이해하고, 공유하고, 선택하기 쉬워진다는 장점은 함수를 짧게 구성할 때 나오는 것이다. 짧은 함수로 구성된 코드를 이해하기 쉽게 만드는 가장 확실한 방법은 좋은 이름이다.

좋은 함수명 본문 코드를 볼 이유가 사라진다. 그러기 위해서는 더 적극적으로 함수를 쪼개야한다. 주석을 달아야할 부분은 무조건 함수로 만든다.

|문제|기법|해결||
|--|--|--|--|
|함수 짧게 만드는 작업|`함수 추출하기`|함수 본문에서 따로 묶어 빼내 좋은 코드 덩어리를 새로운 함수로 만드는 것|6.1|
|함수가 매개변수와 임시 변수를 많이 사용할 경우 추출 작업 곤란|`임시 변수를 질의 함수로 바꾸기`|임시 변수의 수를 줄일 수 있음|7.4|
|함수가 매개변수와 임시 변수를 많이 사용할 경우 추출 작업 곤란|`매개변수 객체 만들기`|매개변수의 수를 줄일 수 있음|11.4|
|함수가 매개변수와 임시 변수를 많이 사용할 경우 추출 작업 곤란|`객체 통째로 넘기기`|매개변수의 수를 줄일 수 있음|11.4|
|위 두 방식을 적용해도 여전히 매개변수와 임시 변수가 많다면|`함수를 명령으로 바꾸기`| |11.4절|

<br />

추출할 코드 덩어리는, 주석을 참고하여 찾아낼 수 있다. 보통 주석은 코드만으로는 목적을 이해하기 어려운 부분에 달려 있는 경우가 많다. 이런 주석을 찾으면 주석이 설명하는 코드와 함꼐 함수로 빼내고, 함수 이름은 주석 내용을 토대로 짓는다. 코드가 단 한 줄이어도 따로 설명할 필요가 있다면 함수로 추출하는 것이 좋다.

<br />

**조건문**

조건문 또한 추출을 통해 리팩터링을 적용할 수 있다.

|문제|기법|해결||
|--|--|--|--|
|조건문 추출하기|`조건문 분해하기`||10.1|
|switch문이 거대할 경우|`함수 추출하기`|각 case의 본문을 함수 호출문 하나로 변환|10.1|
|같은 조건을 기준으로 나뉘는 switch문이 여러 개|`조건부 로직을 다형성으로 바꾸기`||10.4|


**반복문**

반복문도 그 안의 코드와 함께 추출하여 독립된 함수로 만든다. 그러나 이 코드에 적합한 이름이 떠오르지 않을 경우, 성격이 다른 두 가지 작업이 섞여 있기 때문일 수 있다. 이는 `반복문 쪼개기`를 적용해서 작업을 분리한다.

 <br />
 <br />
 <br />

## 3.4 긴 매개변수 목록

|문제|기법|해결||
|--|--|--|--|
|다른 매개변수에서 값을 얻어올 수 있는 매개변수가 있는 경우|`매개변수를 질의 함수로 바꾸기`|해당 매개변수 제거|11.5|
|사용 중인 데이터 구조에서 값을 뽑아 각각을 별개의 매개변수로 전달|`객체 통째로 넘기기`|매개 변수를 하나로 엮음|11.4|
|함수 동작 방식을 정하는 플래그 역할의 매개변수|`플래그 인수 제거하기`|해당 매개변수 제거|11.3|
|여러 개의 함수가 특정 매개변수들의 값을 공통으로 사용|`여러 함수를 클래스로 묶기`|공통 값들을 클래스의 필드로 정의|6.9|

 <br />
 <br />
 <br />

## 3.5 전역 데이터
